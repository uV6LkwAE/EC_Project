
{% extends "base.html" %}

{% block title %}取引詳細{% endblock %}

{% block content %}

{% if is_get_blocked %}
<script type="text/javascript">
    alert('不正な操作です。商品詳細ページに移動します。');
    window.location.href = "{% url 'products:product_detail' product.id %}";
</script>
{% endif %}
<p>{{ transaction.product.id }}</p>
<h2>取引詳細</h2>
<p>商品: {{ transaction.product.title }}</p>
<p>価格: ¥{{ transaction.product.price }}</p>
<p>購入者: {{ transaction.buyer.username }}</p>
<p>出品者: {{ transaction.seller.username }}</p>
<p>配送先: {{ transaction.shipping_address }}</p>
<p>ステータス: {{ transaction.get_status_display }}</p>

<p>DEBUG: {{ transaction.status }}</p>

<!-- 購入者用メッセージ -->
{% if user == transaction.buyer and transaction.status == "pending" %}
<p>商品が発送されるまでお待ちください。</p>
{% endif %}

<!-- 出品者用のボタン -->
{% if user == transaction.seller and transaction.status == "order_confirmed" %}
<form method="post" action="{% url 'transactions:update_transaction_status' transaction.id %}">
    {% csrf_token %}
    <input type="hidden" name="status" value="shipped">
    <button type="submit" class="btn btn-primary">発送完了</button>
</form>
{% endif %}

<!-- 購入者用のボタン -->
{% if user == transaction.buyer and transaction.status == "shipped" %}
<form method="post" action="{% url 'transactions:update_transaction_status' transaction.id %}">
    {% csrf_token %}
    <input type="hidden" name="status" value="received">
    <button type="submit" class="btn btn-success">商品を受け取る</button>
</form>
{% endif %}

<ul class="progressbar">
    <li class="{% if progress_percentage >= 0 %}active{% endif %}">注文確定</li>
    <li class="{% if progress_percentage >= 25 %}active{% endif %} {% if progress_percentage >= 50 %}complete{% endif %}">未発送</li>
    <li class="{% if progress_percentage >= 75 %}active{% endif %} {% if progress_percentage >= 100 %}complete{% endif %}">発送済み</li>
    <li class="{% if progress_percentage == 100 %}active{% endif %}">受け取り完了</li>
</ul>

<style>
    .progressbar {
        position: relative;
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: space-between;
        list-style-type: none;
    }

    .progressbar li {
        position: relative;
        text-align: center;
        text-transform: uppercase;
        width: 25%; /* ステップごとの幅を25%に設定 */
        color: #999999;
        font-weight: bold;
    }

    .progressbar li:before {
        display: block;
        width: 18px;
        height: 18px;
        margin: 7px auto 20px auto;
        content: '';
        text-align: center;
        border-radius: 50%;
        background-color: #F5F5F5;
    }

    .progressbar li:after {
        position: absolute;
        z-index: -1;
        top: 15px;
        left: -50%;
        width: 100%;
        height: 2px;
        content: '';
        background-color: #F5F5F5;
    }

    .progressbar li:first-child:after {
        content: none;
    }

    .progressbar li.active,
    .progressbar li.complete {
        color: #0070BD;
    }

    .progressbar li.active:before,
    .progressbar li.complete:before {
        background-color: #0070BD;
    }

    .progressbar li.active:after,
    .progressbar li.complete:after {
        background-color: #0070BD;
    }

    ul {
    margin: 40px 0 !important;
    }

    body {
    margin: 40px 20px;
    }

</style>

{% endblock %}
